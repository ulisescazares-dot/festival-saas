<!DOCTYPE html>
<html>
<head>
    <title>Panel - Festival SaaS</title>
    <style>
        body { font-family: Arial; background: #f3f4f6; margin: 0; }
        header {
            background: #111827;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
        }
        button {
            background: #ef4444;
            border: none;
            padding: 8px 15px;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        table {
            width: 95%;
            margin: 30px auto;
            border-collapse: collapse;
            background: white;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        th { background: #e5e7eb; }
        .signed { color: green; font-weight: bold; }
        .pending { color: red; font-weight: bold; }
        a { color: #2563eb; }
    </style>
</head>
<body>

<header>
    <h2>Panel de Expositores</h2>
    <button onclick="logout()">Cerrar sesi√≥n</button>
</header>
<div id="metrics" style="display:flex; gap:20px; margin:20px;"></div>
<table>
    <thead>
        <tr>
            <th>Festival</th>
            <th>Evento</th>
            <th>Negocio</th>
            <th>Email</th>
            <th>Estado</th>
            <th>PDF</th>
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
async function loadData() {

    const res = await fetch("/agreements/dashboard");

    if (res.status === 401 || res.status === 422) {
        window.location.href = "/auth/login-page";
        return;
    }

    const response = await res.json();
    const data = response.rows;
    const metrics = response.metrics;
    
    document.getElementById("metrics").innerHTML = `
    <div style="background:white;padding:20px;border-radius:8px;">
        <strong>Total:</strong> ${metrics.total_exhibitors}
    </div>
    <div style="background:white;padding:20px;border-radius:8px;color:green;">
        <strong>Firmados:</strong> ${metrics.signed}
    </div>
    <div style="background:white;padding:20px;border-radius:8px;color:red;">
        <strong>Pendientes:</strong> ${metrics.pending}
    </div>
    <div style="background:white;padding:20px;border-radius:8px;">
        <strong>Amperaje total:</strong> ${metrics.total_amperage} A
    </div>
    `;

    const tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = "";

    data.forEach(row => {
        tableBody.innerHTML += `
            <tr>
                <td>${row.festival}</td>
                <td>${row.event}</td>
                <td>${row.business_name}</td>
                <td>${row.email}</td>
                <td class="${row.signed ? 'signed' : 'pending'}">
                    ${row.signed ? 'Firmado' : 'Pendiente'}
                </td>
                <td>
                    ${row.pdf_url ? `<a href="${row.pdf_url}" target="_blank">Ver PDF</a>` : '-'}
                </td>
            </tr>
        `;
    });
}

async function logout() {
    await fetch("/auth/logout", { method: "POST" });
    window.location.href = "/auth/login-page";
}

loadData();
</script>

</body>
</html>